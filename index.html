<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>專業購物商城</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:"Microsoft JhengHei",Arial,sans-serif;background:#f0f2f5;margin:0;padding:0;}
header{background:#4CAF50;color:white;padding:1em;text-align:center;font-size:1.5em;}
.container{max-width:1000px;margin:auto;padding:1em;}
.products{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1em;}
.card{background:white;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.15);overflow:hidden;display:flex;flex-direction:column;}
.card img{width:100%;height:150px;object-fit:cover;}
.card-body{padding:0.5em;flex:1;display:flex;flex-direction:column;}
.card-body h3{margin:0.2em 0;font-size:1.1em;}
.card-body p{margin:0.2em 0;flex:1;}
.card-body .price{font-weight:bold;color:#4CAF50;}
.card-body button{background:#4CAF50;color:white;border:none;padding:0.5em;border-radius:6px;cursor:pointer;margin-top:0.5em;}
#cartModal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:none;justify-content:center;align-items:center;}
#cartContent{background:white;padding:1em;border-radius:12px;width:90%;max-width:500px;max-height:90%;overflow:auto;}
#cartContent h2{text-align:center;margin-top:0;}
.cart-item{display:flex;justify-content:space-between;margin:0.5em 0;}
.cart-item span{margin:0 0.2em;}
#checkoutBtn{background:#4CAF50;color:white;border:none;padding:0.7em;width:100%;border-radius:6px;margin-top:1em;cursor:pointer;}
#qrcodeContainer{text-align:center;margin-top:1em;}
</style>
</head>
<body>
<header>專業購物商城</header>
<div class="container">
  <div class="products" id="productList"></div>
</div>

<!-- 購物車 Modal -->
<div id="cartModal">
  <div id="cartContent">
    <h2>購物車</h2>
    <div id="cartItems"></div>
    <label>收件人名稱: <input type="text" id="receiverName"></label><br>
    <label>電話: <input type="text" id="receiverPhone"></label><br>
    <label>地址: <input type="text" id="receiverAddress"></label><br>
    <label>取貨方式:
      <select id="deliveryMethod">
        <option value="宅配">宅配</option>
        <option value="自取">自取</option>
      </select>
    </label><br>
    <label id="storeLabel" style="display:none">取貨門市:
      <select id="pickupStore"></select>
    </label><br>
    <label>付款方式:
      <select id="paymentMethod">
        <option value="信用卡">信用卡</option>
        <option value="現金">現金</option>
      </select>
    </label>
    <button id="checkoutBtn">結帳</button>
    <div id="qrcodeContainer"></div>
    <button onclick="document.getElementById('cartModal').style.display='none';">關閉</button>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
const GAS_WEB_APP_URL = "你的GAS Web App URL";
let cart = [];
let products = [];
let userId = "user_"+Math.floor(Math.random()*10000);
let userName = "測試使用者";

/* 取得商品與門市 */
async function init(){
  const res = await fetch(GAS_WEB_APP_URL+"?action=products");
  products = await res.json();
  renderProducts();

  const storeRes = await fetch(GAS_WEB_APP_URL+"?action=stores");
  const stores = await storeRes.json();
  const storeSelect = document.getElementById("pickupStore");
  stores.forEach(s=>{
    const opt = document.createElement("option"); opt.value=s; opt.textContent=s;
    storeSelect.appendChild(opt);
  });
}
init();

/* 顯示商品 */
function renderProducts(){
  const container = document.getElementById("productList");
  container.innerHTML="";
  products.forEach(p=>{
    const div = document.createElement("div"); div.className="card";
    div.innerHTML=`<img src="${p['商品照片']}" alt="${p['商品名稱']}">
      <div class="card-body">
        <h3>${p['商品名稱']}</h3>
        <p>${p['描述'] || ''}</p>
        <div class="price">${p['價格']} 元</div>
        <button onclick="addToCart('${p['商品名稱']}',${p['價格']},'${p['分類'] || ''}')">加入購物車</button>
      </div>`;
    container.appendChild(div);
  });
}

/* 加入購物車 */
function addToCart(name, price, category){
  const exist = cart.find(i=>i.name===name);
  if(exist){ exist.quantity++; }
  else{ cart.push({name, price, category, quantity:1}); }
  renderCart();
  document.getElementById("cartModal").style.display="flex";
}

/* 顯示購物車 */
function renderCart(){
  const container = document.getElementById("cartItems");
  container.innerHTML="";
  cart.forEach((i,idx)=>{
    const div = document.createElement("div"); div.className="cart-item";
    div.innerHTML=`<span>${i.name}</span>
      <span>
      <button onclick="updateQty(${idx},-1)">-</button>
      ${i.quantity}
      <button onclick="updateQty(${idx},1)">+</button>
      </span>
      <span>${i.price*i.quantity} 元</span>`;
    container.appendChild(div);
  });
}

/* 更新數量 */
function updateQty(idx, delta){
  cart[idx].quantity+=delta;
  if(cart[idx].quantity<=0) cart.splice(idx,1);
  renderCart();
}

/* 顯示/隱藏取貨門市 */
document.getElementById("deliveryMethod").onchange=function(){
  if(this.value==="自取") document.getElementById("storeLabel").style.display="block";
  else document.getElementById("storeLabel").style.display="none";
}

/* 結帳 */
document.getElementById("checkoutBtn").onclick=async function(){
  if(cart.length===0){ alert("購物車是空的"); return; }

  const totalAmount = cart.reduce((sum,i)=>sum+i.price*i.quantity,0);
  const deliveryMethod = document.getElementById("deliveryMethod").value;
  let pickupStore = "";
  if(deliveryMethod==="自取") pickupStore = document.getElementById("pickupStore").value;

  const data = {
    userId, userName,
    totalAmount, shippingFee:0,
    paymentMethod: document.getElementById("paymentMethod").value,
    deliveryMethod,
    receiverName: document.getElementById("receiverName").value,
    receiverPhone: document.getElementById("receiverPhone").value,
    receiverAddress: document.getElementById("receiverAddress").value,
    pickupStore, items:cart
  };

  const res = await fetch(GAS_WEB_APP_URL,{method:"POST",body:JSON.stringify(data)});
  const result = await res.json();
  if(result.status!=="success"){ alert("建立訂單失敗"); return; }

  const orderId = result.orderId;
  const orderUrl = `${GAS_WEB_APP_URL}?page=pickup&orderId=${orderId}`;

  // 顯示 QR Code
  document.getElementById("qrcodeContainer").innerHTML="";
  new QRCode(document.getElementById("qrcodeContainer"),{text:orderUrl,width:200,height:200});

  alert(`訂單完成! 訂單號: ${orderId}`);
  cart=[]; renderCart(); document.getElementById("cartModal").style.display="none";
};
</script>
</body>
</html>




























































































































