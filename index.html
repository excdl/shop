<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>專業購物商城</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
  header { background:#4CAF50; color:#fff; padding:15px; text-align:center; font-size:24px; }
  nav { display:flex; justify-content:center; margin:10px 0; }
  nav button { margin:0 5px; padding:10px 20px; border:none; background:#ddd; cursor:pointer; }
  nav button.active { background:#4CAF50; color:#fff; }
  .container { display:flex; flex-wrap:wrap; justify-content:center; }
  .card { background:#fff; width:200px; margin:10px; border-radius:5px; overflow:hidden; box-shadow:0 0 5px rgba(0,0,0,0.2); }
  .card img { width:100%; height:150px; object-fit:cover; }
  .card-body { padding:10px; }
  .card-body h4 { margin:0 0 5px; font-size:16px; }
  .card-body p { margin:5px 0; font-size:14px; color:#333; }
  .card-body input { width:50px; }
  .card-body button { margin-top:5px; padding:5px 10px; border:none; background:#4CAF50; color:#fff; cursor:pointer; }
</style>
</head>
<body>

<header id="welcome">專業購物商城</header>
<nav id="categoryTabs"></nav>
<div class="container" id="productContainer"></div>

<script>
// ===== 設定區 =====
const API_URL = "https://script.google.com/macros/s/AKfycbxSnZiqIZD3W60IXI2v9GKy9YNZDTXHpXaCW87JuMB7HYpnjz1_22VeD62gzEj1Nfry/exec"; // GET 商品 / POST 訂單
let products = [];
let categories = [];
let userName = "2008573741-WGE2G7lZ"; // 可改為 LIFF / LINE Login 取得名稱

// ===== 取得商品清單 =====
async function fetchProducts(){
  try {
    const res = await fetch(API_URL);
    products = await res.json();

    // 取得所有類別
    categories = [...new Set(products.map(p => p.類別))];
    renderCategories();
    renderProducts(categories[0]);
  } catch(e){
    console.error(e);
    alert("無法取得商品清單");
  }
}

// ===== 渲染類別按鈕 =====
function renderCategories(){
  const nav = document.getElementById("categoryTabs");
  nav.innerHTML = "";
  categories.forEach(cat=>{
    const btn = document.createElement("button");
    btn.textContent = cat;
    btn.onclick = ()=> {
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      renderProducts(cat);
    }
    if(nav.children.length===0) btn.classList.add("active");
    nav.appendChild(btn);
  });
}

// ===== 渲染商品卡片 =====
function renderProducts(category){
  const container = document.getElementById("productContainer");
  container.innerHTML = "";
  const filtered = products.filter(p=>p.類別===category);
  filtered.forEach(p=>{
    const card = document.createElement("div");
    card.className = "card";
    const img = document.createElement("img");
    img.src = p.商品照片; // Google Drive 直接網址或可轉為可公開 URL
    const body = document.createElement("div");
    body.className = "card-body";
    body.innerHTML = `
      <h4>${p.商品名稱}</h4>
      <p>${p.特色說明 || ""}</p>
      <p>價格: ${p.售價}</p>
      <label>數量: <input type="number" min="1" value="1" id="qty_${p.商品名稱}"></label>
      <button onclick="orderProduct('${p.商品名稱}')">加入購物車</button>
    `;
    card.appendChild(img);
    card.appendChild(body);
    container.appendChild(card);
  });
}

// ===== 送出訂單 =====
async function orderProduct(productName){
  const product = products.find(p=>p.商品名稱===productName);
  const qty = parseInt(document.getElementById("qty_"+productName).value);
  if(qty<1){ alert("數量至少 1"); return; }

  const data = {
    userId: "LINE_USER_ID", // 可透過 LIFF 取得
    userName: userName,
    orderTime: new Date(),
    productCategory: product.類別,
    productId: product.商品照片, // 或自己設定 ID
    productName: product.商品名稱,
    quantity: qty,
    price: parseFloat(product.售價.replace("NT$","")) || 0,
    subtotal: (parseFloat(product.售價.replace("NT$",""))*qty).toFixed(2),
    receiverName: "",
    receiverPhone: "",
    receiverAddress: "",
    paymentMethod: "",
    remark: ""
  };

  try{
    const res = await fetch(API_URL, {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(data)
    });
    const result = await res.json();
    if(result.message==="成功") alert("訂單已送出");
    else alert("訂單送出失敗");
  }catch(e){
    console.error(e);
    alert("送單失敗");
  }
}

// ===== 初始化 =====
document.getElementById("welcome").textContent = userName + " 您好，歡迎光臨";
fetchProducts();
</script>
</body>
</html>






